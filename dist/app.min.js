var app=app||{};app.events=function(e,a,t){var r=function(e,a){t(document).trigger(e,[a])},n=function(e,a){t(document).on(e,function(e,t){a(t)})};return{publish:r,subscribe:n}}(window,document,jQuery);var app=app||{};app.s=function(e,a){var t={formFilled:!1,currentSlide:null,isAnimating:!1,pageHeight:null,yesNoState:!1,propertyData:null};return app.events.subscribe("state-change",function(e){void 0!==e.isAnimating&&(t.isAnimating=e.isAnimating),void 0!==e.formFilled&&(t.formFilled=e.formFilled),void 0!==e.currentSlide&&(t.currentSlide=e.currentSlide),void 0!==e.pageHeight&&(t.pageHeight=e.pageHeight),void 0!==e.yesNoState&&(t.yesNoState=e.yesNoState),void 0!==e.propertyData&&(t.propertyData=e.propertyData),app.events.publish("state-updated",t)}),{state:t}}(window,document);var app=app||{};app.el=function(e,a,t){function r(e){this.dd=e,this.placeholder=this.dd.children("span"),this.opts=this.dd.find("ul.drop-down > li > a"),this.val=void 0,this.name=void 0,this.index=-1,this.initEvents()}function n(){return o={navGoNext:a.querySelectorAll(".go-next"),navGoFirst:a.querySelectorAll(".go-first"),navGoFour:a.querySelectorAll(".go-step4"),burgerIcon:a.querySelector(".burger"),navBar:a.querySelector(".main-nav"),mainNavList:a.querySelector(".main-nav ul"),progressCircles:a.querySelectorAll(".margin-circles li"),slidesContainer:a.querySelector(".slides-container"),slides:a.querySelectorAll(".slide"),slide4:a.querySelector("#slide-8"),dd:new r(t(".user-data.borough-select")),addressInput:a.querySelector(".address-input"),boroSelect:a.querySelector(".user-data.borough-select"),boroDropDown:a.getElementById("boroughs"),boroDropDownItems:a.querySelectorAll("#boroughs li a"),selectBoro:a.getElementsByName("borough"),search:a.querySelector(".search"),valErrors:a.querySelectorAll(".validation-error"),valErrorAddress:a.getElementById("error-address"),valErrorBoro:a.getElementById("error-boro"),valErrorNF:a.getElementById("error-not-found"),yes:a.querySelectorAll(".yes"),no:a.querySelectorAll(".no"),yesNoState:!1,map:a.getElementById("map"),mapMessage:a.querySelector(".map-message"),mailTo:a.getElementById("mail-to"),lightBox:a.getElementById("rent-history"),addToCalendar:a.getElementById("atc_text_link"),addToCalendarLink:a.querySelector(".atcb-link"),noTR:a.querySelector(".no-local-tr"),yesTR:a.querySelector(".yes-local-tr"),trModal:a.getElementsByClassName("tr-modal")[0],learnMore:a.querySelector(".button.learn-more")}}var o;return r.prototype={initEvents:function(){var e=this;e.dd.on("click",function(e){return e.preventDefault(),app.f.toggleClass(this,"active"),!1}),e.opts.on("click",function(a){a.preventDefault();var r=t(this);e.val=r.data("boro"),e.name=r.text(),e.index=r.index(),e.placeholder.text("Borough: "+e.name)})},getValue:function(){return this.val},getIndex:function(){return this.index}},{refDOM:n}}(window,document,jQuery);var app=app||{};app.helpers=function(e,a,t){function r(){return app.f={addEventListenerList:function(e,a,t){var r=0,n=e.length;for(r;n>r;r++)e[r].addEventListener(a,t,!1)},onKeyDown:function(e){var a=e.keyCode;a===o.UP?(app.f.goToPrevSlide(),e.preventDefault()):a===o.DOWN&&(app.f.goToNextSlide(),e.preventDefault())},onMouseWheel:function(e){var a=e/30||-e;-1>a?app.f.goToNextSlide():a>1&&app.f.goToPrevSlide()},getSlideIndex:function(e){for(var a,t=0;t<app.el.slides.length;t++)app.el.slides[t]===e&&(a=t);return a},goToSlide:function(e){if(!n.isAnimating&&e){app.events.publish("state-change",{isAnimating:!0,currentSlide:e});var a=app.f.getSlideIndex(e);TweenLite.to(app.el.slidesContainer,1,{scrollTo:{y:n.pageHeight*a},onComplete:app.f.onSlideChangeEnd})}},goToPrevSlide:function(e){var a=app.f.getSlideIndex(n.currentSlide)-1;console.log("go previous slide",a),a>=0&&(app.f.goToSlide(app.el.slides[a]),e&&"function"==typeof e&&e())},goToNextSlide:function(e){var a=app.f.getSlideIndex(n.currentSlide),t=app.el.slides[a+1];t&&(0===a||a>=1&&n.formFilled===!0)&&(app.f.goToSlide(t),e&&"function"==typeof e&&e())},goToFirstSlide:function(){n.currentSlide&&(app.el.addressInput.value="",app.f.resetSearchResultMsg(),app.f.hideFormValidationErrors(),app.f.resetBoroValue(),app.map.resetMap(),app.f.addClass(t.yes,"hidden"),app.f.removeClass(t.no,"hidden"),app.f.addClass(t.yesTR,"hidden"),app.f.removeClass(t.noTR,"hidden"),a.querySelector(".tr-modal").innerHTML="",app.f.goToSlide(app.el.slides[0]),app.events.publish("state-change",{formFilled:!1}))},onSlideChangeEnd:function(){app.events.publish("state-change",{isAnimating:!1}),app.f.updateProgCircles(n.currentSlide)},updateProgCircles:function(a){var t,r=app.f.getSlideIndex(a),n=0,o=app.el.progressCircles.length;for(t=e.innerHeight<=700||e.innerWidth<=1100?"20px":"25px",n;o>n;n++){var p=app.el.progressCircles[n];r===n?(p.style.backgroundImage="url(../assets/png/oval_25_filled.png)",p.style.backgroundSize=t,p.style.backgroundRepeat="no-repeat"):(p.style.background="url(../assets/png/oval_25_blank.png)",p.style.backgroundSize=t,p.style.backgroundRepeat="no-repeat")}},onResize:function(){var a=e.innerHeight-60,t=n.currentSlide,r=app.f.getSlideIndex(t);n.pageHeight!==a&&(app.events.publish("state-change",{pageHeight:a}),TweenLite.set([app.el.slidesContainer,app.el.slides],{height:n.pageHeight+"px"}),TweenLite.set(app.el.slidesContainer,{scrollTo:{y:n.pageHeight*r}}))},iterateNodeList:function(e,a){if(e&&e.length){var t=0,r=e.length;for(t;r>t;t++)return a(e[t],t)}return e&&!e.length?a(e):void 0},indexOf:function(e,a){for(var t=0;t<e.length;t++)if(e[t]===a)return t;return-1},hasClass:function(e,a){return app.f.iterateNodeList(e,function(e){return e.classList?e.classList.contains(a):new RegExp("(^| )"+a+"( |$)","gi").test(e.className)})},addClass:function(e,a){app.f.iterateNodeList(e,function(e){e.classList?e.classList.add(a):e.className+=" "+a})},toggleClass:function(e,a){app.f.iterateNodeList(e,function(e){if(e.classList)e.classList.toggle(a);else{var t=e.className.split(" "),r=t.indexOf(a);r>=0?t.splice(r,1):(t.push(a),e.className=t.join(" "))}})},removeClass:function(e,a){app.f.iterateNodeList(e,function(e){e.classList?e.classList.remove(a):e.className=e.className.replace(new RegExp("(^|\\b)"+a.split(" ").join("|")+"(\\b|$)","gi")," ")})},resetSearchResultMsg:function(){app.el.yesNoState===!0&&(app.f.toggleClass(t.yes,"hidden"),app.f.toggleClass(t.no,"hidden"),app.el.yesNoState=!1)},hideFormValidationErrors:function(){var e=0,a=app.el.valErrors.length;for(e;a>e;e++)app.f.hasClass(app.el.valErrors[e],"vis-hidden")===!1&&app.f.addClass(app.el.valErrors[e],"vis-hidden")},resetBoroValue:function(){app.el.dd.val=void 0,app.el.dd.placeholder.text("Select a Borough")},addToCalendar:function(){var t,r,n=new Date;t=new Date(n),t.setDate(t.getDate()+7),r=new Date(n),r.setDate(t.getDate()+1),app.el.addToCalendar.innerHTML='<var class="atc_event"><var class="atc_date_start">'+t+'</var><var class="atc_date_end">'+r+'</var><var class="atc_timezone">America/New_York</var><var class="atc_title">Check mail for my rent history</var><var class="atc_description">See if your rent history arrived in the mail, then go back to http://amirentstabilzed.com!</var><var class="atc_location">my house</var></var>',e.addtocalendar.load();var o=a.querySelector(".atcb-link");o.innerHTML="Create a calendar reminder.",o.tabindex="-1"}},app.f}var n=app.s;app.f={},app.events.subscribe("state-updated",function(e){n=e});var o={UP:38,DOWN:40};return{registerfns:r}}(window,document,app.el);var app=app||{};app.l=function(e,a,t,r,n){function o(){app.events.subscribe("state-updated",function(e){p=e}),e.onresize=app.f.onResize,addWheelListener(e,function(e){app.f.onMouseWheel(e.deltaY),e.preventDefault()}),e.onkeydown=app.f.onKeyDown,app.f.addEventListenerList(app.el.navGoNext,"click",app.f.goToNextSlide),app.f.addEventListenerList(app.el.navGoFour,"click",function(e){e.preventDefault(),app.events.publish("state-change",{formFilled:!0}),app.f.hideFormValidationErrors(),app.f.goToSlide(app.el.slides[6])}),app.el.burgerIcon.addEventListener("click",function(e){e.preventDefault(),app.f.toggleClass(app.el.burgerIcon,"open"),app.f.toggleClass(app.el.mainNavList,"responsive")}),app.el.slidesContainer.addEventListener("click",function(e){app.f.hasClass(app.el.boroSelect,"active")&&app.f.removeClass(app.el.boroSelect,"active")}),app.el.search.addEventListener("click",function(e){e.preventDefault();var a=app.el.addressInput.value,t=app.el.dd.getValue();_gaq.push(["_trackEvent","Address Entered","Search",a+", "+t]),app.a.checkAddressInput(a,t)}),app.f.addEventListenerList(app.el.navGoFirst,"click",app.f.goToFirstSlide),app.el.addressInput.addEventListener("blur",function(e){""!==app.el.addressInput.value&&app.f.hasClass(r.valErrorAddress,"vis-hidden")!==!0&&app.f.addClass(app.el.valErrorAddress,"vis-hidden")}),app.f.addEventListenerList(app.el.boroDropDownItems,"click",function(e){app.f.hasClass(app.el.valErrorBoro,"vis-hidden")!==!0&&void 0!==app.el.dd.getValue&&app.f.addClass(app.el.valErrorBoro,"vis-hidden")}),app.el.lightBox.addEventListener("click",function(a){a.preventDefault(),app.f.goToSlide(app.el.slides[6]),e.location.hash=""})}{var p=app.s;app.a}return{listen:o}}(window,document,jQuery,app.el,app.f);var app=app||{};app.a=function(e,a){function t(){return{checkAddressInput:function(e,a){if(""!==e&&void 0!==a){app.events.publish("state-change",{formFilled:!0}),app.f.goToNextSlide();var t=app.a.parseAddressInput(e);setTimeout(function(){console.log("form filled, parsed address: ",t),app.map.geoclient(t[0],t[1],a)},1e3)}else""===e&&void 0===a?app.f.hasClass(app.el.valErrorAddress,"vis-hidden")===!0&&app.f.hasClass(app.el.valErrorBoro,"vis-hidden")===!0&&(app.f.toggleClass(app.el.valErrorAddress,"vis-hidden"),app.f.toggleClass(app.el.valErrorBoro,"vis-hidden")):void 0===a?app.f.hasClass(app.el.valErrorBoro,"vis-hidden")===!0&&app.f.toggleClass(app.el.valErrorBoro,"vis-hidden"):""===e?app.f.hasClass(app.el.valErrorAddress,"vis-hidden")===!0&&app.f.toggleClass(app.el.valErrorAddress,"vis-hidden"):app.f.goToPrevSlide()},parseAddressInput:function(e){var a=e.split(" "),t=a.length,r=a[0],n=a.splice(1,t),o=n.join(" ");return[r,o]},createMailTo:function(){var e="rentinfo@nyshcr.org",a="request for rent history",t="Hello, \n\nI, YOUR NAME HERE, am currently renting YOUR ADDRESS, APARTMENT NUMBER, BOROUGH, ZIPCODE and would like to request the rent history for this apartment. Any information you can provide me would be greatly appreciated. \n\nthank you,\n\n- YOUR NAME HERE",r="mailto:"+encodeURIComponent(e)+"?subject="+encodeURIComponent(a)+"&body="+encodeURIComponent(t);app.el.mailTo.setAttribute("href",r)}}}app.el,app.fns,app.s;return{address:t}}(window,document);var app=app||{};app.map=function(e,a,t,r,n){function o(e,a,r){t().url(e).type(a).on("success",function(e){r(e),console.log("getJSON data: ",e)}).on("error",function(e){r("error")}).go()}function p(e,a){var t="SELECT * FROM nyc_tenants_rights_service_areas WHERE ST_Contains(nyc_tenants_rights_service_areas.the_geom,ST_GeomFromText('Point("+a+" "+e+")', 4326));";return t}function s(e){if(e.rows.length>0&&g.yesNoState===!1){var a=JSON.stringify(e.rows[0].bbl);_gaq.push(["_trackEvent","CDB","Match",a]),app.f.toggleClass(app.el.yes,"hidden"),app.f.toggleClass(app.el.no,"hidden"),app.events.publish("state-change",{yesNoState:!0})}app.f.goToNextSlide()}function l(e){if(e.rows.length>0){app.f.addClass(S,"hidden"),app.f.removeClass(C,"hidden");var a=0,t=e.rows.length;for(a;t>a;a++){var r=e.rows[a];h.tr_groups.push(r),E.orgs.push(i(r))}var n=b(E);m.innerHTML=n,h.tr_groups.length=0}}function i(e){var a={name:e.name,website:e.website_url,phone:e.phone,email:e.email,address:e.address,description:e.description};return a}function d(){u=app.el,f=app.f,g=app.s,I()}var c,u={},f={},g=app.s,v="https://chenrick.cartodb.com/api/v2/sql?q=",h={},m=e.getElementsByClassName("tr-modal")[0],y=n("#org-template").html(),b=r.compile(y),S=e.querySelector(".no-local-tr"),C=e.querySelector(".yes-local-tr"),E={orgs:[]};Handlebars.registerHelper("each",function(e,a){for(var t="",r=0,n=e.length;n>r;r++)t+=a.fn(e[r]);return t}),Handlebars.registerHelper("if",function(e,a){return e?a.fn(this):a.inverse(this)}),app.events.subscribe("state-updated",function(e){g=e});var N=function(e,a,t){var r="9cd0a15f",n="app_id="+r+"&",p="54dc84bcaca9ff4877da771750033275",s="app_key="+p,l="houseNumber="+e+"&",i=a.replace(" ","+"),d="street="+i+"&",c="borough="+t+"&",u="https://api.cityofnewyork.us/geoclient/v1/address.json?",f=u+l+d+c+n+s;console.log("getting json..."),o(f,"jsonp",T)},T=function(e){if("object"==typeof e&&void 0!==e.address.bbl){var a=e.address;h={bbl:a.bbl,lon:a.longitudeInternalLabel,lat:a.latitudeInternalLabel,hNo:a.houseNumber,sName:a.streetName1In,bCode:a.boroughCode1In,bUSPS:a.uspsPreferredCityName,zip:a.zipCode,cd:a.communityDistrict,bin:a.giBuildingIdentificationNumber1,tr_groups:[]};var t=a.bbl,r=JSON.stringify(h);_gaq.push(["_trackEvent","Geoclient Success","Result",r]),console.log("geoclient success, data: ",h),w(t),_(e)}else app.el.addressInput.value="",app.f.resetBoroValue(),app.f.hasClass(app.el.valErrorNF,"vis-hidden")===!0&&app.f.toggleClass(app.el.valErrorNF,"vis-hidden"),app.f.hasClass(app.el.valErrorBoro,"vis-hidden")===!1&&app.f.addClass(app.el.valErrorBoro,"vis-hidden"),app.f.hasClass(app.el.valErrorAddress,"vis-hidden")===!1&&app.f.addClass(app.el.valErrorAddress,"vis-hidden"),app.events.publish("state-change",{formFilled:!1}),app.f.goToPrevSlide()},w=function(e){var a="SELECT bbl FROM map_pluto_likely_rs WHERE bbl = "+e,t=p(h.lat,h.lon);o(v+a,"json",s),o(v+t,"json",l)},_=function(e){var a=e.address.longitudeInternalLabel,t=e.address.latitudeInternalLabel,r=[t,a],n=e.address.houseNumber+" "+e.address.firstStreetNameNormalized+"<br>"+e.address.uspsPreferredCityName+", NY "+e.address.zipCode;c&&app.el.map.removeLayer(c),c=new L.marker(r).addTo(u.map),c.on("popupopen",function(e){app.el.map.setView(r,16)}),c.bindPopup("<b>"+n+"</b>").openPopup()},I=function(){app.el.map=new L.Map("map",{center:[40.7127,-74.0059],zoom:12,dragging:!1,touchZoom:!1,doubleClickZoom:!1,scrollWheelZoom:!1,zoomControl:!1,keyboard:!1});var e,a=L.tileLayer("http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://cartodb.com/attributions">CartoDB</a>'}),t="https://chenrick.cartodb.com/api/v2/viz/20b7c6ac-ee12-11e4-b74e-0e853d047bba/viz.json",r="#all_map_pluto_rent_stabl_reg_2014v1 {polygon-fill: #FF6600;polygon-opacity: 0.6;line-color: #000;line-width: 0.7;line-opacity: 0.3;}";app.el.map.addLayer(a),cartodb.createLayer(u.map,t,{cartodb_logo:!1,legends:!1,https:!0,fullscreen:!0},function(t){e=t.getSubLayer(0),e.setCartoCSS(r),app.el.map.addLayer(t,!1),a.bringToBack()}).done(function(e){})},k=function(){c&&app.el.map.removeLayer(c),app.el.map.setView([40.7127,-74.0059],12)};return{init:d,geoclient:N,resetMap:k}}(document,window,aja,Handlebars,jQuery);var app=app||{};app.init=function(e,a){function t(){var e=Handlebars.templates.main;$.getJSON("../data/content.json",function(a){html=e(a.languages[0].en),document.querySelector("#wrapper").innerHTML=html}).done(function(){app.el=app.el.refDOM(),app.a=app.a.address(),app.f=app.helpers.registerfns(),app.l.listen(),app.events.publish("state-change",{currentSlide:app.el.slides[0]}),app.f.onResize(),app.f.goToSlide(app.el.currentSlide),app.a.createMailTo(),app.f.addToCalendar(),app.map.init()})}return{init:t}}(window,document);